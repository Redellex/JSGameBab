<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
      <title>Babylon Fun</title>

      <style>
        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none; 
        }

        #holder {
        width: 80%;
        height: 100%;
        float: left;
        }

        #instructions {
        width: 20%;
        height: 100%;
        float: left;
        background-color: grey;
        }
    </style>

    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://code.jquery.com/pep/0.4.1/pep.js"></script>
   </head>
   <body>

    <div id = "holder">
        <canvas id="renderCanvas" touch-action="none"></canvas> 
    </div>
    <div id = "instructions">
    <br/>
        <h2>Instructions</h2>
    <br/>
        Instructions Instructions Instructions Instructions Instructions 
        Instructions Instructions Instructions Instructions Instructions 
    </div>


    <canvas id="renderCanvas" touch-action="none"></canvas> //touch-action="none" for best results from PEP

    <script>
            var canvas = document.getElementById("renderCanvas"); // Get the canvas element 
            var engine = new BABYLON.Engine(canvas, true); // Generate the BABYLON 3D engine
            var scene = new BABYLON.Scene(engine);

            var CreateGround = function() {
                const ground = BABYLON.MeshBuilder.CreateGround("ground", {width:55, height:55});
                const groundMat = new BABYLON.StandardMaterial("groundMat");
                groundMat.diffuseColor = new BABYLON.Color3(0, 1, 0);
                ground.material = groundMat; 
            };

            var CreateNewSceneWithCamera = function() {
                var camera = new BABYLON.ArcRotateCamera("Camera", Math.PI / 2, 15 * Math.PI / 32, 25, BABYLON.Vector3.Zero(), scene);
                camera.attachControl(canvas, true);
                var hemiLight = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(1, 1, 0), scene);
            };

            var CreateHouse = function(){
                faceUV = [];
                faceUV[0] = new BABYLON.Vector4(0.5, 0.0, 0.75, 1.0); //rear face
                faceUV[1] = new BABYLON.Vector4(0.0, 0.0, 0.25, 1.0); //front face
                faceUV[2] = new BABYLON.Vector4(0.25, 0, 0.5, 1.0); //right side
                faceUV[3] = new BABYLON.Vector4(0.75, 0, 1.0, 1); //left side

                const box = BABYLON.MeshBuilder.CreateBox("box", {width: 2, height: 1.5, depth: 3, faceUV: faceUV, wrap: true})
                const roof = BABYLON.MeshBuilder.CreateCylinder("roof", {diameter: 3.9, height: 3, tessellation: 3})
                box.position.y = 0.5;
                box.rotation.y = BABYLON.Tools.ToRadians(45);

                roof.rotation.y = BABYLON.Tools.ToRadians(45);
                roof.scaling.x = 0.60;
                roof.scaling.y = 0.8;
                roof.rotation.z = Math.PI / 2;
                roof.position.y = 1.75;

                const roofMat = new BABYLON.StandardMaterial("roofMat");
                roofMat.diffuseTexture = new BABYLON.Texture("https://assets.babylonjs.com/environments/roof.jpg", scene);
                const boxMat = new BABYLON.StandardMaterial("boxMat");
                boxMat.diffuseTexture = new BABYLON.Texture("https://doc.babylonjs.com/_next/image?url=%2Fimg%2Fgetstarted%2Fsemihouse.png&w=1920&q=75");

                roof.material = roofMat;
                box.material = boxMat;
                return BABYLON.Mesh.MergeMeshes([box, roof],true, false, null, false, true)
            };

            var CreateMultipleHouses = function (house){
                clonedHouse = house.clone("clonedHouse")
                instanceHouse = house.createInstance("instanceHouse")

                var places = [[0, 1, 5], [2,1,10], [0, 1, 15], [0, 1, 20], [0, 1, 25], [0, 15, 5], [0, 15, 10], [0, 15, 15]];
                const houses = [];
                for (let i = 0; i < places.length; i++) {
                    if (places[i][0] === 1) {
                        houses[i] = house.createInstance("house" + i);
                    }
                    else {
                        houses[i] = house.createInstance("house" + i);
                    }
                    houses[i].rotation.y = places[i][0];
                    houses[i].position.x = places[i][1];
                    houses[i].position.z = places[i][2];

                    
                }
            };

            var createScene = function () {
                    CreateNewSceneWithCamera();
                    CreateGround();
                    house = CreateHouse();
                    CreateMultipleHouses(house);

                    return scene;
                };

                var scene = createScene();

            engine.runRenderLoop(function () { // Register a render loop to repeatedly render the scene
                    scene.render();
            });


            window.addEventListener("resize", function () { // Watch for browser/canvas resize events
                    engine.resize();
            });
    </script>

   </body>

</html>